{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"SOPS Operator","text":"<p>A Kubernetes operator that decrypts SOPS-encrypted secrets and creates native Kubernetes Secrets.</p> <ul> <li> <p>:material-lock: Secure by Design</p> <p>Full SOPS YAML stored in CRD including MAC for integrity verification</p> </li> <li> <p>:material-key: AGE Encryption</p> <p>Simple, secure encryption with no cloud dependencies</p> </li> <li> <p>:material-sync: GitOps Ready</p> <p>Store encrypted secrets in Git, operator handles decryption</p> </li> <li> <p>:material-kubernetes: Cloud Native</p> <p>Built with controller-runtime, follows Kubernetes patterns</p> </li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Install the operator\nkubectl apply -f https://github.com/scalaric/sops-operator/releases/latest/download/install.yaml\n</code></pre> <p>Get Started View on GitHub</p>"},{"location":"#why-sops-operator","title":"Why SOPS Operator?","text":"<p>Managing secrets in Kubernetes with GitOps is challenging. You want to store everything in Git, but secrets need to stay secret. SOPS Operator solves this by:</p> <ol> <li>Encrypting secrets with SOPS - Store encrypted YAML in Git</li> <li>Storing encrypted data in CRDs - Apply encrypted secrets to Kubernetes</li> <li>Automatic decryption - Operator decrypts and creates native Secrets</li> </ol> <pre><code>apiVersion: secrets.scalaric.io/v1alpha1\nkind: SopsSecret\nmetadata:\n  name: my-secret\nspec:\n  sopsSecret: |\n    apiVersion: v1\n    kind: Secret\n    data:\n      password: ENC[AES256_GCM,data:...,type:str]\n    sops:\n      age:\n        - recipient: age1...\n          enc: |\n            -----BEGIN AGE ENCRYPTED FILE-----\n            ...\n</code></pre>"},{"location":"#features","title":"Features","text":"<ul> <li>:white_check_mark: Decrypts SOPS-encrypted YAML and creates Kubernetes Secrets</li> <li>:white_check_mark: Supports AGE encryption</li> <li>:white_check_mark: Full SOPS YAML stored in CRD (including MAC)</li> <li>:white_check_mark: Automatic Secret recreation if deleted</li> <li>:white_check_mark: Owner references for automatic cleanup</li> <li>:white_check_mark: Status conditions for observability</li> <li>:white_check_mark: Suspend functionality for maintenance</li> </ul>"},{"location":"SCORECARD/","title":"OpenSSF Scorecard","text":"<p>This document describes the security practices implemented in this project and how to achieve a perfect OpenSSF Scorecard score.</p>"},{"location":"SCORECARD/#current-score","title":"Current Score","text":""},{"location":"SCORECARD/#automated-checks-code","title":"Automated Checks (Code)","text":"Check Implementation Pinned-Dependencies All GitHub Actions and Docker images pinned to SHA hashes with version comments Token-Permissions Workflow-level <code>permissions: {}</code> with minimal per-job permissions SAST CodeQL analysis (<code>codeql.yml</code>) + Gosec security scanner Fuzzing Native Go fuzz tests (<code>pkg/sops/fuzz_test.go</code>) Signed-Releases Cosign keyless signatures for all release artifacts Dangerous-Workflow No <code>pull_request_target</code> with write permissions Binary-Artifacts No binaries committed to repository Dependency-Update-Tool Dependabot configured for Go, Docker, and GitHub Actions Vulnerabilities Automated scanning via Dependabot and CodeQL Security-Policy <code>SECURITY.md</code> with vulnerability reporting process License Apache 2.0 (<code>LICENSE</code>) CI-Tests Comprehensive test suite runs on all PRs"},{"location":"SCORECARD/#manual-configuration-required","title":"Manual Configuration Required","text":""},{"location":"SCORECARD/#branch-protection","title":"Branch Protection","text":"<p>Configure via Settings \u2192 Branches \u2192 Add rule for <code>main</code>:</p> <pre><code>\u2713 Require pull request before merging\n  \u2713 Require 1 approval\n  \u2713 Dismiss stale approvals when new commits are pushed\n  \u2713 Require review from Code Owners\n\u2713 Require status checks to pass\n  \u2713 Require branches to be up to date\n  \u2192 Add checks: Lint, Test, Build, Docker Build, Security Scan, Analyze\n\u2713 Require conversation resolution\n\u2713 Do not allow bypassing the above settings\n</code></pre>"},{"location":"SCORECARD/#openssf-best-practices-badge","title":"OpenSSF Best Practices Badge","text":"<ol> <li>Visit https://www.bestpractices.dev</li> <li>Add project: <code>github.com/scalaric/sops-operator</code></li> <li>Complete the questionnaire</li> <li>Add badge to README</li> </ol>"},{"location":"SCORECARD/#verifying-release-signatures","title":"Verifying Release Signatures","text":"<p>All release artifacts are signed with Cosign using keyless signing (Fulcio + Rekor).</p> <pre><code># Install cosign\nbrew install cosign\n\n# Download release artifacts\nVERSION=v1.0.0\ncurl -sLO \"https://github.com/scalaric/sops-operator/releases/download/${VERSION}/install.yaml\"\ncurl -sLO \"https://github.com/scalaric/sops-operator/releases/download/${VERSION}/install.yaml.sig\"\ncurl -sLO \"https://github.com/scalaric/sops-operator/releases/download/${VERSION}/install.yaml.pem\"\n\n# Verify signature\ncosign verify-blob \\\n  --signature install.yaml.sig \\\n  --certificate install.yaml.pem \\\n  --certificate-identity-regexp \"https://github.com/scalaric/sops-operator/\" \\\n  --certificate-oidc-issuer \"https://token.actions.githubusercontent.com\" \\\n  install.yaml\n\n# Verify container image\ncosign verify ghcr.io/scalaric/sops-operator:${VERSION} \\\n  --certificate-identity-regexp \"https://github.com/scalaric/sops-operator/\" \\\n  --certificate-oidc-issuer \"https://token.actions.githubusercontent.com\"\n</code></pre>"},{"location":"SCORECARD/#workflow-overview","title":"Workflow Overview","text":"Workflow Trigger Purpose <code>ci.yml</code> Push, PR Lint, test, build, security scan <code>codeql.yml</code> Push, PR, weekly CodeQL static analysis <code>fuzz.yml</code> Push, PR, daily Go native fuzz testing <code>release.yml</code> Tag push Build, sign, and publish release <code>scorecard.yml</code> Push to main, weekly OpenSSF Scorecard analysis <code>dependabot-auto-merge.yml</code> Dependabot PR Auto-merge patch/minor updates <code>release-please.yml</code> Push to main Automated release management"},{"location":"SCORECARD/#pinned-dependencies-guidelines","title":"Pinned Dependencies Guidelines","text":""},{"location":"SCORECARD/#docker-images-in-dockerfile","title":"Docker Images in Dockerfile","text":"<p>All Docker base images must include SHA256 digests for Scorecard compliance:</p> <pre><code># CORRECT - with SHA256 digest\nFROM golang:1.25-alpine@sha256:d9b2e14101f27ec8d09674cd01186798d227bb0daec90e032aeb1cd22ac0f029 AS builder\n\n# INCORRECT - will fail Scorecard\nFROM golang:1.25-alpine AS builder\n</code></pre> <p>To get the SHA256 digest for an image:</p> <pre><code>docker pull &lt;image&gt;:&lt;tag&gt;\ndocker inspect &lt;image&gt;:&lt;tag&gt; --format='{{index .RepoDigests 0}}'\n</code></pre> <p>The <code>renovate</code> comments before each FROM statement enable automated updates while maintaining pinned digests.</p>"},{"location":"SCORECARD/#github-actions","title":"GitHub Actions","text":"<p>All GitHub Actions must be pinned to commit SHAs with version comments:</p> <pre><code># CORRECT\n- uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1\n\n# INCORRECT\n- uses: actions/checkout@v4\n</code></pre>"},{"location":"SCORECARD/#local-verification","title":"Local Verification","text":"<pre><code># Run scorecard locally\nbrew install scorecard\nscorecard --repo=github.com/scalaric/sops-operator\n\n# Check specific check\nscorecard --repo=github.com/scalaric/sops-operator --checks=Pinned-Dependencies\n\n# Run fuzz tests locally\ngo test -fuzz=FuzzParseDecryptedYAML -fuzztime=30s ./pkg/sops/\ngo test -fuzz=FuzzValidateEncryptedYAML -fuzztime=30s ./pkg/sops/\n</code></pre>"},{"location":"api-reference/","title":"API Reference","text":""},{"location":"api-reference/#sopssecret","title":"SopsSecret","text":"<p><code>SopsSecret</code> is the primary custom resource for managing SOPS-encrypted secrets.</p>"},{"location":"api-reference/#metadata","title":"Metadata","text":"<pre><code>apiVersion: secrets.scalaric.io/v1alpha1\nkind: SopsSecret\n</code></pre>"},{"location":"api-reference/#spec","title":"Spec","text":"<pre><code>spec:\n  # Required: The SOPS-encrypted secret content\n  sopsSecret: string\n\n  # Optional: Name for the generated Secret (defaults to SopsSecret name)\n  secretName: string\n\n  # Optional: Type of the generated Secret (defaults to Opaque)\n  secretType: string\n\n  # Optional: Additional labels for the generated Secret\n  secretLabels:\n    key: value\n\n  # Optional: Additional annotations for the generated Secret\n  secretAnnotations:\n    key: value\n\n  # Optional: Suspend reconciliation (defaults to false)\n  suspend: bool\n</code></pre>"},{"location":"api-reference/#status","title":"Status","text":"<pre><code>status:\n  # Conditions indicating the state of the SopsSecret\n  conditions:\n    - type: string      # Decrypted, Ready\n      status: string    # True, False, Unknown\n      reason: string\n      message: string\n      lastTransitionTime: string\n      observedGeneration: int\n\n  # Name of the managed Secret\n  secretName: string\n\n  # SHA256 hash of the encrypted content\n  lastDecryptedHash: string\n\n  # Timestamp of last successful decryption\n  lastDecryptedTime: string\n\n  # Generation that was last observed\n  observedGeneration: int\n</code></pre>"},{"location":"api-reference/#rbac","title":"RBAC","text":"<p>The operator requires the following permissions:</p> <pre><code># For SopsSecret resources\n- apiGroups: [\"secrets.scalaric.io\"]\n  resources: [\"sopssecrets\"]\n  verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\", \"delete\"]\n\n- apiGroups: [\"secrets.scalaric.io\"]\n  resources: [\"sopssecrets/status\"]\n  verbs: [\"get\", \"update\", \"patch\"]\n\n- apiGroups: [\"secrets.scalaric.io\"]\n  resources: [\"sopssecrets/finalizers\"]\n  verbs: [\"update\"]\n\n# For managed Secrets\n- apiGroups: [\"\"]\n  resources: [\"secrets\"]\n  verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\", \"delete\"]\n\n# For events\n- apiGroups: [\"\"]\n  resources: [\"events\"]\n  verbs: [\"create\", \"patch\"]\n</code></pre>"},{"location":"api-reference/#events","title":"Events","text":"<p>The operator emits the following events:</p> Reason Type Description <code>Decrypted</code> Normal Successfully decrypted SOPS data <code>DecryptFailed</code> Warning Failed to decrypt SOPS data <code>SecretCreated</code> Normal Created new Secret <code>SecretUpdated</code> Normal Updated existing Secret <code>SecretDeleted</code> Normal Deleted managed Secret <code>ValidationFailed</code> Warning SOPS YAML validation failed"},{"location":"configuration/","title":"Configuration","text":""},{"location":"configuration/#sopssecret-spec","title":"SopsSecret Spec","text":"Field Type Description Default <code>sopsSecret</code> string Required. The SOPS-encrypted YAML content - <code>secretName</code> string Name of the Kubernetes Secret to create Same as SopsSecret name <code>secretType</code> string Type of the Kubernetes Secret <code>Opaque</code> <code>secretLabels</code> map[string]string Additional labels for the Secret <code>{}</code> <code>secretAnnotations</code> map[string]string Additional annotations for the Secret <code>{}</code> <code>suspend</code> bool Suspend reconciliation <code>false</code>"},{"location":"configuration/#example","title":"Example","text":"<pre><code>apiVersion: secrets.scalaric.io/v1alpha1\nkind: SopsSecret\nmetadata:\n  name: database-credentials\n  namespace: production\nspec:\n  # Custom secret name (optional)\n  secretName: db-secret\n\n  # Secret type (optional)\n  secretType: Opaque\n\n  # Additional labels (optional)\n  secretLabels:\n    app: my-app\n    environment: production\n\n  # Additional annotations (optional)\n  secretAnnotations:\n    description: \"Database credentials for production\"\n\n  # Suspend reconciliation (optional)\n  suspend: false\n\n  # The encrypted SOPS content (required)\n  sopsSecret: |\n    apiVersion: v1\n    kind: Secret\n    data:\n      username: ENC[AES256_GCM,data:...]\n      password: ENC[AES256_GCM,data:...]\n    sops:\n      age:\n        - recipient: age1...\n</code></pre>"},{"location":"configuration/#operator-configuration","title":"Operator Configuration","text":"<p>The operator is configured via environment variables:</p> Variable Description Required <code>SOPS_AGE_KEY</code> AGE private key content Yes* <code>SOPS_AGE_KEY_FILE</code> Path to AGE private key file Yes* <p>*One of <code>SOPS_AGE_KEY</code> or <code>SOPS_AGE_KEY_FILE</code> is required.</p>"},{"location":"configuration/#status-conditions","title":"Status Conditions","text":"<p>The operator sets the following conditions on SopsSecret:</p> Condition Description <code>Decrypted</code> Whether the SOPS data was successfully decrypted <code>Ready</code> Whether the Secret is up to date <p>Example status:</p> <pre><code>status:\n  conditions:\n    - type: Decrypted\n      status: \"True\"\n      reason: Success\n      message: Successfully decrypted SOPS data\n    - type: Ready\n      status: \"True\"\n      reason: Success\n      message: Secret my-secret is up to date\n  secretName: my-secret\n  lastDecryptedHash: \"abc123...\"\n  lastDecryptedTime: \"2024-01-15T10:30:00Z\"\n  observedGeneration: 1\n</code></pre>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This guide will help you install SOPS Operator and create your first encrypted secret.</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes cluster (1.26+)</li> <li>AGE key pair</li> <li>SOPS CLI (for encrypting secrets)</li> <li>kubectl configured to access your cluster</li> </ul>"},{"location":"getting-started/#installation","title":"Installation","text":""},{"location":"getting-started/#1-generate-an-age-key","title":"1. Generate an AGE key","text":"<pre><code>age-keygen -o age.key\n# Note the public key (age1xxx...) - you'll use it for encryption\n</code></pre>"},{"location":"getting-started/#2-install-the-operator","title":"2. Install the operator","text":"<pre><code>kubectl apply -f https://github.com/scalaric/sops-operator/releases/latest/download/install.yaml\n</code></pre>"},{"location":"getting-started/#3-create-the-age-key-secret","title":"3. Create the AGE key secret","text":"<pre><code>kubectl create secret generic sops-age-key \\\n  --from-file=age.key=./age.key \\\n  -n sops-operator-system\n</code></pre>"},{"location":"getting-started/#create-your-first-secret","title":"Create Your First Secret","text":""},{"location":"getting-started/#1-create-a-secret-file","title":"1. Create a secret file","text":"secret.yaml<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: my-app-secret\ntype: Opaque\nstringData:\n  username: admin\n  password: super-secret-password\n  api-key: sk-1234567890\n</code></pre>"},{"location":"getting-started/#2-encrypt-with-sops","title":"2. Encrypt with SOPS","text":"<pre><code>export SOPS_AGE_RECIPIENTS=\"age1your-public-key-here\"\nsops --encrypt --age $SOPS_AGE_RECIPIENTS secret.yaml &gt; secret.enc.yaml\n</code></pre>"},{"location":"getting-started/#3-create-sopssecret-resource","title":"3. Create SopsSecret resource","text":"sopssecret.yaml<pre><code>apiVersion: secrets.scalaric.io/v1alpha1\nkind: SopsSecret\nmetadata:\n  name: my-app-secret\n  namespace: default\nspec:\n  sopsSecret: |\n    # Paste the contents of secret.enc.yaml here\n</code></pre> <p>Or use this one-liner:</p> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: secrets.scalaric.io/v1alpha1\nkind: SopsSecret\nmetadata:\n  name: my-app-secret\n  namespace: default\nspec:\n  sopsSecret: |\n$(cat secret.enc.yaml | sed 's/^/    /')\nEOF\n</code></pre>"},{"location":"getting-started/#4-verify","title":"4. Verify","text":"<pre><code># Check the SopsSecret status\nkubectl get sopssecret my-app-secret -o yaml\n\n# Check the created Secret\nkubectl get secret my-app-secret -o yaml\n</code></pre>"},{"location":"getting-started/#whats-next","title":"What's Next?","text":"<ul> <li>Configuration - Learn about all configuration options</li> <li>API Reference - Complete API documentation</li> <li>Security - Security best practices</li> </ul>"},{"location":"security/","title":"Security","text":""},{"location":"security/#overview","title":"Overview","text":"<p>SOPS Operator is designed with security as a primary concern. This page documents security considerations and best practices.</p>"},{"location":"security/#encryption","title":"Encryption","text":""},{"location":"security/#age-encryption","title":"AGE Encryption","text":"<p>SOPS Operator uses AGE encryption, which provides:</p> <ul> <li>X25519 key exchange - Modern elliptic curve cryptography</li> <li>ChaCha20-Poly1305 - Authenticated encryption</li> <li>No cloud dependencies - Works entirely offline</li> </ul>"},{"location":"security/#sops-features","title":"SOPS Features","text":"<p>The operator leverages SOPS features:</p> <ul> <li>Message Authentication Code (MAC) - Ensures integrity of encrypted data</li> <li>Key rotation support - Rotate keys without re-encrypting all secrets</li> <li>Audit trail - SOPS metadata shows encryption details</li> </ul>"},{"location":"security/#key-management","title":"Key Management","text":""},{"location":"security/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Never commit private keys to Git <pre><code># Add to .gitignore\necho \"*.key\" &gt;&gt; .gitignore\necho \"age.key\" &gt;&gt; .gitignore\n</code></pre></p> </li> <li> <p>Use separate keys per environment <pre><code>age-keygen -o age-dev.key\nage-keygen -o age-staging.key\nage-keygen -o age-prod.key\n</code></pre></p> </li> <li> <p>Store private keys securely</p> </li> <li>Use a secrets manager (Vault, AWS Secrets Manager)</li> <li> <p>Or Kubernetes Secrets with RBAC restrictions</p> </li> <li> <p>Rotate keys periodically <pre><code># Generate new key\nage-keygen -o age-new.key\n\n# Re-encrypt secrets with new key\nsops updatekeys secret.enc.yaml\n</code></pre></p> </li> </ol>"},{"location":"security/#rbac","title":"RBAC","text":""},{"location":"security/#operator-permissions","title":"Operator Permissions","text":"<p>The operator runs with minimal permissions:</p> <ul> <li>Only accesses <code>SopsSecret</code> and <code>Secret</code> resources</li> <li>Namespace-scoped by default</li> <li>No cluster-admin privileges</li> </ul>"},{"location":"security/#recommended-user-permissions","title":"Recommended User Permissions","text":"<pre><code># Allow creating SopsSecrets but not reading Secrets\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: sopssecret-creator\nrules:\n  - apiGroups: [\"secrets.scalaric.io\"]\n    resources: [\"sopssecrets\"]\n    verbs: [\"get\", \"list\", \"create\", \"update\", \"delete\"]\n</code></pre>"},{"location":"security/#network-security","title":"Network Security","text":"<ul> <li>Operator makes no outbound network connections</li> <li>All decryption happens locally</li> <li>No telemetry or data collection</li> </ul>"},{"location":"security/#supply-chain-security","title":"Supply Chain Security","text":""},{"location":"security/#signed-releases","title":"Signed Releases","text":"<p>All releases are signed with Cosign:</p> <pre><code># Verify container image\ncosign verify ghcr.io/scalaric/sops-operator:v1.0.0\n\n# Verify release artifacts\ncosign verify-blob --signature install.yaml.sig install.yaml\n</code></pre>"},{"location":"security/#sbom","title":"SBOM","text":"<p>Software Bill of Materials (SBOM) is published with each release in SPDX format.</p>"},{"location":"security/#provenance","title":"Provenance","text":"<p>SLSA provenance attestation is attached to release artifacts.</p>"},{"location":"security/#reporting-vulnerabilities","title":"Reporting Vulnerabilities","text":"<p>Please report security vulnerabilities via GitHub Security Advisories:</p> <p>Report a vulnerability</p> <p>See SECURITY.md for details.</p>"}]}